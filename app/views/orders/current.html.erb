<h2>Shopping Cart</h2>

<h3>Order <%= @current_order.id %></h3>


<table class="table">
    <thead>
        <tr>
            <th>Product Name</th>
            <th>Quantity</th>
            <th>Unit Price</th>
            <th>Subtotal</th>
            <th> Update</th>
            <th>Delete</th>
        </tr>
        </thead>
        <tbody>
        <% @current_order.order_products.each do |op| %>
        <%@order_product = op%>
        <% product = Product.find_by(id: op.product_id)%>
            <tr>
                <td><%= product.name %></td>
                <td><%= op.quantity %></td>
                <td><%= format("$%.2f", product.price) %></td>
                <td><%= format("$%.2f", op.total_price) %></td>
                <td> 
                    <%= render 'update-quantity' %>
                </td>
                <td><%= link_to "Delete", order_product_path(op), method: "delete", data: { confirm: "Are you sure?" } %></td>
            </tr>
        <% end %>
        <tr>
            <td colspan=3></td>
            <td>Total Price: <%= format("$%.2f", @order.checkout_amount) %></td>
        </tr>
    </tbody>
</table>

<%= form_with model: @order, method: :post, url: checkout_path, class: 'form' do |f| %>

<section class="field">
    <%= f.label :name, "Name" %>
    <%= f.text_field :name, required: true %>
</section>

<section class="field">
    <%= f.label :email, "Email" %>
    <%= f.text_field :email %>
</section>

<section class="field">
    <%= f.label :address1, "Street Address" %>
    <%= f.text_field :address1 %>
</section>

<section class="field">
    <%= f.label :city, "City" %>
    <%= f.text_field :city %>
</section>

<section class="field">
    <%= f.label :state, "State" %>
    <%= f.text_field :state %>
</section>

<section class="field">
    <%= f.label :zip, "ZIP Code" %>
    <%= f.text_field :zip %>
</section>

<section class="field">
    <%= f.label :last_four_cc, "Credit Card Number" %>
    <%= f.text_field :last_four_cc %>
</section>

<section class="field">
    <%= f.label :expiration, "Expiration (MM/YY)" %>
    <%= f.text_field :expiration %>
</section>

<section class="field">
    <%= f.label :cvv, "CVV" %>
    <%= f.text_field :cvv %>
</section>

<div class = "action">
    <%= f.submit "Check Out" %>
</div>

<%end%>